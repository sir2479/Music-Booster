<!DOCTYPE html>

<!-- =========================================================
* Sneat - Bootstrap 5 HTML Admin Template - Pro | v1.0.0
==============================================================

* Product Page: https://themeselection.com/products/sneat-bootstrap-html-admin-template/
* Created by: ThemeSelection
* License: You must have a valid license purchased in order to legally use the theme for your project.
* Copyright ThemeSelection (https://themeselection.com)

=========================================================
 -->
<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default" data-assets-path="../assets/" data-template="vertical-menu-template-free">

<head th:replace="~{head :: #head}"></head>
   <head>
    <title>Read</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
   	<script>
		function deleteBoard(board_id) {
			console.log("deleteBoard 실행");
			console.log(board_id);
        	if (confirm('삭제한 게시글은 복구할 수 없습니다. 정말로삭제하시겠습니까?')) {
				alert('삭제되었습니다');
            	location.replace('/board/delete?board_id=' + board_id);
			}
		}
	</script>
    <script th:inline="javascript">
        function writeComments() {
            let comments_board = /*[[${board.board_id}]]*/ '';
            console.log(comments_board);
            let comments_content = $("#comments").val();
            $.ajax({
                url: "/comments/" + comments_board,
                type: "post",
                data: {
                    "comments_content": comments_content
                },
                success: function (data) {
                    console.log(data);
                    getFindAllComments();
                },
                error: function (xhr, status, error) {
                    console.log(xhr);
                    console.log(status);
                    console.log(error);
                }
            });
        }
		// 댓글 데이터 가져옴
        function getFindAllComments() {
            let comments_board = /*[[${board.board_id}]]*/ '';
            $.ajax({
                url: "/comments/" + comments_board,
                success: function (data) {
                    console.log(data);
           		  showAllComments(data);
                },
                error: function (xhr, status, error) {
                    console.log(status);
                }
            });
        }

        function showAllComments(data) {
            $("#findAllComments").html("");
            let str = "";
            str += "<table>";
            str += "	<tr>";
            str += "		<th>No.</th>";
            str += "		<th>작성자</th>";
            str += "		<th>내용</th>";
            str += "		<th>작성일</th>";
            str += "	</tr>";
            if (data.length > 0) {
                $(data).each(function (idx, obj) {
                    str += "<tr>";
                    str += "	<td>" + (idx + 1) + "</td>";
                    str += "	<td>" + obj.comments_member + "</td>";
                    str += "	<td>" + obj.comments_content + "</td>";
                    str += "	<td>" + obj.comments_create_time + "</td>";
                    str += "</tr>";
                });
            } else {
                str += "<tr>";
                str += "<td class='center' colspan='4'>등록된 댓글이 없습니다.</td>";
                str += "</tr>";
            }
            str += "</table>";
            $("#findAllComments").append(str);
            feather.replace();
        }
        		//댓글 삭제
		function removeComments(comments_id){
			if(confirm("삭제하시겠습니까?")){
				$.ajax({
					url: "/comments/" + comments_id,
					type: "delete",
					success: function(data){
						console.log(data);
						getFindAllComments();
					},
					error: function(status){
						console.log(status);
						alert("삭제할 수 없습니다.");
					}
				});
			}
		}
		
		//댓글 수정 창
		function getUpdateComments(comments_id, comments_content){
			let str = "";
			str += "<a onclick='updateComments(" + comments_id + ")'><i class='float-end feather-sm' data-feather='save' style='margin-bottom: 10px;'></i></a>";
			str += "<textarea rows='2' class='form-control' id='updateComments'>" + comments_content + "</textarea>";
			$("#" + comments_id).empty();
			$("#"+comments_id).append(str);	
			feather.replace();		
		}
		
		//댓글 수정
		function updateComments(comments_id){
			let content = $("#updateComments").val();
			if(confirm("수정하시겠습니까?")){
				$.ajax({
					url: "/comments/" + comments_id,
					type: "put",
					data: {
						"comments_content": content
					},
					success: function(data){
						console.log(data);
						getFindAllComments();
					},
					error: function(status){
						console.log(status);
						alert("수정할 수 없습니다.");
					}
				});
			}
		}

        //페이지가 로딩되면 getReplies() 함수를 자동으로 호출한다.
        $(document).ready(function () {
            getFindAllComments();
        })
    </script>
</head>

<style>
    section {
        width: 500px;
        padding: 15px;
        border: 5px solid gray;
    }
</style>

<body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">

            <!-- 사이드 메뉴바 -->
            <aside th:replace="~{menu :: #layout-menu}"></aside>

            <!-- Layout container -->
            <div class="layout-page">

                <!-- 헤더 유저바 -->
                <nav th:replace="~{navbar :: #layout-navbar}"></nav>

                <!-- Content wrapper -->
                <div class="content-wrapper">

                    <!-- Content -->
                    <div class="container-xxl flex-grow-1 container-p-y">
                        <h4 class="fw-bold py-3 mb-4">
                            <th:block th:with="board_category=${T(com.example.mub.model.board.BoardCategory).valueOf(param.board_category)}">
                                <h1 class="h3 mb-3" th:text="${board_category.description}"></h1>
                            </th:block>
                            <span class="text-muted fw-light"></span>
                        </h4>

<!-- Basic Bootstrap Table -->
<div class="card">
    <h5 class="card-header"></h5>
    
    <div class="table-responsive text-nowrap">
        <table class="table" th:object="${board}">
            <tbody>
                                        <tr>
                                            <th class="mb-0">제목</th>
                                            <td th:text="*{board_title}"></td>
											<td class="align-middle"><small class="text-light fw-semibold"></small></td>
											<td class="py-3">
                                            <th>작성일</th>
                                            <td><span th:text="${#temporals.format(board.board_create_time, 'yy-MM-dd hh:mm')}"></span></td>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="mb-0">작성자</th>
                                            <td th:text="*{board_member}"></td>
											<td class="align-middle"><small class="text-light fw-semibold"></small></td>
											<td class="py-3">
                                        </tr>
                                        <tr>
                                            <th class="mb-0">내용</th>
											<td class="align-middle"><small class="text-light fw-semibold"></small></td>
											<td class="py-3">
                                        </tr>
                                        
                                        <div class="row">
                                       <div class="col-md-6 col-sm-12">
					                 	<div class="card overflow-hidden mb-4" style="height: 500px">
					                    <div class="card-body" id="vertical-example">
					                    <td th:text="*{board_content}"></td>
                                            
                                        </div>
                                        </div>    
                                        </div>
                                        </div>
                                        
<!--                                        <tr>
                                            <th>작성일</th>
                                            <td><span th:text="${#temporals.format(board.board_create_time, 'yyyy-MM-dd hh:mm')}"></span></td>
                                        </tr>-->
                                        <tr th:if="${board.board_edit_time} != null">
                                            <th>수정일</th>
                                            <td><span th:text="${#temporals.format(board.board_edit_time, 'yyyy-MM-dd HH:mm')}"></span></td>
                                        </tr>
                                        <tr>
                                            <th>조회수</th>
                                            <td th:text="*{board_hit}"></td>
                                        </tr>
                                    </thead>
                                    </tbody>
                                </table>
                                <p>
                                    <span style="right: auto;">
                                        <input type="button" th:onclick="|location.href='@{/board/list(board_category=${board_category})}'|" value="목록으로" class="btn btn-sm btn-outline-primary">
                                        <th:block th:if="${session.loginMember != null}">
                                            <input type="button" th:if="${session.loginMember.member_id == board.board_member}" th:onclick="|location.href='@{/board/update(board_id=${board.board_id},board_category=${board_category})}'|" value="수정하기" class="btn btn-sm btn-outline-primary">
                                            <input type="button" th:if="${session.loginMember.member_id == board.board_member}" th:onclick="'javascript:deleteBoard(\''+ ${board.board_id} +'\');'" value="삭제하기" class="btn btn-sm btn-outline-primary">
                                        </th:block>
                                    </span>
                                    <br>
                                    <div>
                                        <label for="comments">댓글 달기</label>
                                        <input type="text" id="comments" name="comments">
                                        <input type="button" value="등록" onclick="writeComments()">
                                    </div>
	 						</div>
						  <p>
							  <!-- 댓글 출력 -->
				  <div id="findAllComments">
					<!--  <th:block th:if="${session.loginMember != null}">
                         <input type="button" th:if="${session.loginMember.member_id == comments.comments_member}" th:onclick="|location.href='@{/comments/update(board_id=${board.board_id},board_category=${board_category})}'|" value="수정하기" class="btn btn-sm btn-outline-primary">
                         <input type="button" th:if="${session.loginMember.member_id == comments.comments_member}" th:onclick="|location.href='@{/comments/delete(board_id=${board.board_id},board_category=${board_category})}'|" value="삭제하기" class="btn btn-sm btn-outline-primary">
                      </th:block>-->
				  </div>				  
                </div>
              </div>
              <!--/ Basic Bootstrap Table -->
            </div>
            <!-- / Content -->

            <footer th:replace="~{footer :: #footer}"></footer>

            <div class="content-backdrop fade"></div>
          </div>
          <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
      </div>

      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>
    </div>
    <!-- / Layout wrapper -->

  </body>
  <body th:replace="~{scr :: #scr}"></body>
</html>